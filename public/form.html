<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>email form</title>
  </head>
  <body>
    <form action="/email_post" method="post">
      email: <input type="text" name="email" /><br />
      <input type="submit" />
    </form>

    <button class="ajaxSend">ajax send</button>
    <div class="result"></div>

    <script>
      document.querySelector('.ajaxSend').addEventListener('click', () => {
        const inputData = document.forms[0].elements[0].value;
        sendAjax('http://127.0.0.1:3000/ajax_send_email', inputData);
      });

      const sendAjax = (url, data) => {
        let myData = { email: data };
        myData = JSON.stringify(myData);
        const xhr = new XMLHttpRequest();
        xhr.open('POST', url);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.send(myData);
        xhr.addEventListener('load', () => {
          const result = JSON.parse(xhr.responseText);
          if (result.result !== 'ok') return;
          document.querySelector('.result').innerHTML =
            'Welcome! ' + result.email;
        });
      };
    </script>
  </body>
</html>
